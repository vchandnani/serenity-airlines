module.exports=[27884,a=>{"use strict";var b=a.i(28184);a.i(9870);let c=new(a.i(6331)).default(process.env.STRIPE_SECRET_KEY);var d=a.i(98310);async function e(a){let b=await (0,d.createClient)(),{data:e}=await b.from("flights").select("*").eq("id",a.flightId).single();if(!e)throw Error("Flight not found");let f=`AI${Date.now().toString(36).toUpperCase()}`,{data:{user:g}}=await b.auth.getUser(),h=await c.checkout.sessions.create({ui_mode:"embedded",redirect_on_completion:"never",line_items:[{price_data:{currency:"inr",product_data:{name:`${e.flight_number}: ${e.origin} â†’ ${e.destination}`,description:`Seat ${a.seatNumber} - ${a.seatClass.charAt(0).toUpperCase()+a.seatClass.slice(1)} Class`},unit_amount:a.price},quantity:1}],mode:"payment",customer_email:a.passengerEmail,metadata:{flightId:a.flightId,seatNumber:a.seatNumber,seatClass:a.seatClass,passengerName:a.passengerName,passengerEmail:a.passengerEmail,bookingReference:f,userId:g?.id||"guest"}});return await b.from("bookings").insert({user_id:g?.id||null,flight_id:a.flightId,passenger_name:a.passengerName,passenger_email:a.passengerEmail,seat_number:a.seatNumber,seat_class:a.seatClass,price_paid:a.price,booking_reference:f,payment_status:"pending",stripe_session_id:h.id}),await b.from("seats").update({is_available:!1}).eq("flight_id",a.flightId).eq("seat_number",a.seatNumber),{clientSecret:h.client_secret}}(0,a.i(29355).ensureServerEntryExports)([e]),(0,b.registerServerReference)(e,"400d274fe3ffead251219883ea41a5e76531030318",null),a.s([],56129),a.i(56129),a.s(["400d274fe3ffead251219883ea41a5e76531030318",()=>e],27884)}];

//# sourceMappingURL=_next-internal_server_app_book_%5Bid%5D_page_actions_05c68512.js.map